---
title: "Daten zusammenspielen"
author: "Peter Baumgartner"
date: "2017-03-19"
output: 
        html_notebook:
                toc: yes
                toc_depth: 3
                
---
***

```{r label = "global-options", echo=FALSE, highlight=TRUE}
knitr::opts_chunk$set(
        message = F,
        error = F,
        warning = F,
        comment = NA,
        highlight = T,
        prompt = T
        )

if (!require("tidyverse")) 
        {install.packages("tidyverse", repos = 'http://cran.wu.ac.at/')
        library(tidyverse)}
if (!require("reshape2"))
        {install.packages("reshape2", repos = 'http://cran.wu.ac.at/')
        library(reshape2)}
if (!require("readxl"))
        {install.packages("readxl", repos = 'http://cran.wu.ac.at/')
        library(readxl)}
if (!require("pander"))
        {install.packages("pander", repos = 'http://cran.wu.ac.at/')
        library(pander)}

# install packages for writing Excel file (xlsx-format)
if (!require("xlsx")) 
        {install.packages("xlsx", repos = 'http://cran.wu.ac.at/')
        library(xlsx)}
if (!require("rJava"))
        {install.packages("rJava", repos = 'http://cran.wu.ac.at/')
        library(rJava)}
if (!require("xlsxjars"))
        {install.packages("xlsxjars", repos = 'http://cran.wu.ac.at/')
        library(xlsxjars)}


```

# Datensätze (Excelsheets) zusammenfügen

```{r combine-all-data-sets}


tirol1 <- readRDS("../daten/tirol.1.rds")
tirol2 <- readRDS("../daten/tirol.2.rds")
tirol3 <- readRDS("../daten/tirol.3.rds")
tirol4 <- readRDS("../daten/tirol.4.rds")
tirol5 <- readRDS("../daten/tirol.5.rds")
tirol0 <- do.call("cbind", list(tirol1, tirol2, tirol3, tirol4, tirol5))
tirol0 <- as_tibble(tirol0)
saveRDS(tirol0, file = "../daten/tirol0.rds")

write.xlsx(x = tirol0, file = "../daten/tirol0.xlsx",
           sheetName = "Umfrage", col.names = TRUE, showNA = TRUE)
      
```



# Kommentare trennen und abspeichern
```{r kommentare-beseitigen}
tirol.notes <- select(tirol0, starts_with("note."))
tirol <- select(tirol0, -starts_with("note."))
write.xlsx(x = tirol, file = "../daten/tirol.xlsx", 
           sheetName = "Umfrage", col.names = TRUE, showNA = TRUE, append = FALSE) 
write.xlsx(x = tirol.notes, file = "../daten/tirol.xlsx", 
           sheetName = "Kommentare", col.names = TRUE, showNA = TRUE, append = TRUE) 
saveRDS(tirol, file = "../daten/umfrage.rds" )
saveRDS(tirol.notes, file = "../daten/kommentare.rds" )
```

# Variablen faktorisieren mit Reihenfolge der Ausprägungen

Hier habe ich etwas umständlich viele Versionen ausprobiert:

* Ursprünglich hatte ich als Ausprägung nur 1-5 (als Zeichenkette, nicht als Zahl!) oben übergeben. Das ist aber nicht selbsterklärend und erfordert eine Codierungstabelle. 
* Danach habe ich gleich die Ausprägungen selbst übergeben. Das hat aber den Nachteil, dass dann die Tabelle (das Datenset) sehr unübersichtlicht wird. 
* Die Ausprägungen werden in der alphabetischen Reihenfolge der Faktoren in der Grafik dargestellt. Das ist nicht nur unschön, sondern verwirrend. So beginnt die Grafik dann mit "ausbaufähig" und "sehr gut" kommt ganz hinten.
* Die Ausprägungen sind aber jetzt immer noch Zeichenketten-Variablen, Tyus "char" gespeichert wie z.B. "sehr gut", "ausreichend" etc. Sie müsssen in Faktor-Variablen mit unterschiedlichen Ausprägungen ("levels") umgewandelt werden. Der Befehl dazu lautet:

> <datensatz.name>$<variablen.name> <- factor(<datensatz.name>$<variablen.name>)

Es ist aber extrem wichtig auch gleich die Reihenfolge festzulegen, weil ansonsten die Darstellung in den Grafiken alfabetisch erfolgt, d.h. in der Reihenfolge "ausbaufähig", "ausreichend", "nicht vorhanden", "schlecht", sehr gut". Um das zu verhindern müssen mit der Umwandlung auch Namen der Ausprägungen ("levels") in der richtigen Reihenfolge übergeben werden. 

Vom Zusatz: "ordered = TRUE" sehe ich hier einmal aus zwei Gründen ab, 

* weil ich das wahrscheinlich nicht brauchen werde und
* weil die Reihenfolge "sehr gut" < "ausreichend" < "ausbaufähig" etc. eigenartig anmutet (wenn dann müsste hier eigentlich das "größer"-Zeichen ">" kommen).

```{r generate-factors}

audiemus <- tirol

audiemus$schultyp <- recode(audiemus$schultyp, "A" = "AHS", "B" = "NMS", "C" = "PTS")


audiemus$t.pc.nein <- recode(audiemus$t.pc.nein, "A" = "sehr gut", "B" = "ausreichend", "C" = "ausbaufähig", "D" = "schlecht", "E" = "nicht vorhanden")
audiemus$t.tablet <- recode(audiemus$t.tablet, "A" = "sehr gut", "B" = "ausreichend", "C" = "ausbaufähig", "D" = "schlecht", "E" = "nicht vorhanden")
audiemus$t.lan <- recode(audiemus$t.lan, "A" = "sehr gut", "B" = "ausreichend", "C" = "ausbaufähig", "D" = "schlecht", "E" = "nicht vorhanden")
audiemus$t.wlan <- recode(audiemus$t.wlan, "A" = "sehr gut", "B" = "ausreichend", "C" = "ausbaufähig", "D" = "schlecht", "E" = "nicht vorhanden")
audiemus$t.beamer <- recode(audiemus$t.beamer, "A" = "sehr gut", "B" = "ausreichend", "C" = "ausbaufähig", "D" = "schlecht", "E" = "nicht vorhanden")
audiemus$t.whiteboard <- recode(audiemus$t.whiteboard, "A" = "sehr gut", "B" = "ausreichend", "C" = "ausbaufähig", "D" = "schlecht", "E" = "nicht vorhanden")
audiemus$t.kopfhoerer <- recode(audiemus$t.kopfhoerer, "A" = "sehr gut", "B" = "ausreichend", "C" = "ausbaufähig", "D" = "schlecht", "E" = "nicht vorhanden")

# ######
# 
audiemus$k.computer <- recode(audiemus$k.computer, "A" = "sehr gut", "B" = "gut", "C" = "ausreichend", "D" = "verbesserungswürdig", "E" = "schlecht")
audiemus$k.didaktik <- recode(audiemus$k.didaktik, "A" = "sehr gut", "B" = "gut", "C" = "ausreichend", "D" = "verbesserungswürdig", "E" = "schlecht")
audiemus$k.motivation <- recode(audiemus$k.motivation, "A" = "sehr gut", "B" = "gut", "C" = "ausreichend", "D" = "verbesserungswürdig", "E" = "schlecht")
audiemus$k.schueler <- recode(audiemus$k.schueler, "A" = "sehr gut", "B" = "gut", "C" = "ausreichend", "D" = "verbesserungswürdig", "E" = "schlecht")
audiemus$k.schule <- recode(audiemus$k.schule, "A" = "sehr gut", "B" = "gut", "C" = "ausreichend", "D" = "verbesserungswürdig", "E" = "schlecht")
audiemus$k.it.betreuung <- recode(audiemus$k.it.betreuung, "A" = "sehr gut", "B" = "gut", "C" = "ausreichend", "D" = "verbesserungswürdig", "E" = "schlecht")
# 
# #######
# 
audiemus$w.ausstattung <- recode(audiemus$w.ausstattung, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.raumwechsel <- recode(audiemus$w.raumwechsel, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.curricula <- recode(audiemus$w.curricula, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.kooperation <- recode(audiemus$w.kooperation, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.mehrwert <- recode(audiemus$w.mehrwert, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.fachbildung <- recode(audiemus$w.fachbildung, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.support <- recode(audiemus$w.support, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.did.bildung <- recode(audiemus$w.did.bildung, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.ausstattung <- recode(audiemus$w.ausstattung, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.plattform <- recode(audiemus$w.plattform, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.zeit <- recode(audiemus$w.zeit, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.anerkennung <- recode(audiemus$w.anerkennung, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.informatik <- recode(audiemus$w.informatik, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.med.kompetenz <- recode(audiemus$w.med.kompetenz, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$w.digi.buch <- recode(audiemus$w.digi.buch, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")

# #######

audiemus$i.fach <- recode(audiemus$i.fach, "A" = "sehr interessiert", "B" = "interessiert", "C" = "nicht interessiert")
audiemus$i.allgemein <- recode(audiemus$i.allgemein, "A" = "sehr interessiert", "B" = "interessiert", "C" = "nicht interessiert")
audiemus$i.schueler <- recode(audiemus$i.schueler, "A" = "sehr interessiert", "B" = "interessiert", "C" = "nicht interessiert")
audiemus$i.planung <- recode(audiemus$i.planung, "A" = "sehr interessiert", "B" = "interessiert", "C" = "nicht interessiert")
audiemus$i.handy <- recode(audiemus$i.handy, "A" = "sehr interessiert", "B" = "interessiert", "C" = "nicht interessiert")
audiemus$i.fortbildung <- recode(audiemus$i.fortbildung, "A" = "sehr interessiert", "B" = "interessiert", "C" = "nicht interessiert")

# ######
 
audiemus$medien.deutsch <- recode(audiemus$medien.deutsch, "A" = "ja", "B" = "manchmal", "C" = "fast nie", "D" = "nein")
audiemus$a.eingesetzt <- recode(audiemus$a.eingesetzt, "A" = "ja", "B" = "nein")
audiemus$a.keine.zeit <- recode(audiemus$a.keine.zeit, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$a.kein.interesse <- recode(audiemus$a.kein.interesse, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$a.keine.technik <- recode(audiemus$a.keine.technik, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$a.keine.kompetenz <- recode(audiemus$a.keine.kompetenz, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$a.zu.kompliziert <- recode(audiemus$a.zu.kompliziert, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")

# ########

audiemus$e.technik.ok <- recode(audiemus$e.technik.ok, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$e.usability <- recode(audiemus$e.usability, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$e.relevant <- recode(audiemus$e.relevant, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$e.technik.ok <- recode(audiemus$e.technik.ok, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$e.zusatz <- recode(audiemus$e.zusatz, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$e.test <- recode(audiemus$e.test, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")
audiemus$e.praktikabel <- recode(audiemus$e.praktikabel, "A" = "trifft voll zu", "B" = "trifft weitgehend zu", "C" = "trifft überwiegend zu","D" = "trifft eher nicht zu", "E" = "trifft gar nicht zu")


```

# Spalten nach Reihung im Fragebogen sortieren

```{r spalten-reihenfolge-aendern}
audiemus <- audiemus[c(1, 37, 2:15, 38:51, 16:36)]
```

# Abspeichern
```{r save-data}
saveRDS(audiemus, file = "../daten/audiemus.rds")

write.xlsx(x = audiemus, file = "../daten/audiemus.xlsx",
           sheetName = "Umfrage", col.names = TRUE, showNA = TRUE)
      
```

